<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>SBC Book Reviews</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="#">
    <!-- link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous" -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
    <!-- link rel="stylesheet" href="../css/shards.min.css" -->
</head>

<body>
<div class="container my-2" ></div>
    <div class="card">
        <div class="card-body">
            <div th:switch="@{/allBooks}" class="container my-5">
                <p class="my-5">
                    <a th:href="@{/addNewReview}" class="btn btn-primary">
                        <i class="fas fa-plus ml-2">Add a Book</i></a>
                </p>
                <div class="col-md-12">
                    <h2 th:case="null">No Books Yet!</h2>
                    <div th:case="*">
                        <table class="table table-responsive-md">
                            <thead>
                            <tr>
                                <th>
                                    <span th:if="${sortField == 'title'}" th:text="${sortDir == 'asc' ? '↑' : '↓'}"></span>
                                    <a th:href="@{'/getAllBooks'(sortField='title', sortDir=${reverseSortDir})}">Title</a>
                                </th>
                                <th>
                                    <span th:if="${sortField == 'author'}" th:text="${sortDir == 'asc' ? '↑' : '↓'}"></span>
                                    <a th:href="@{'/getAllBooks'(sortField='author', sortDir=${reverseSortDir})}">Author</a>
                                </th>
                                <th>
                                    <span th:if="${sortField == 'ISBN'}" th:text="${sortDir == 'asc' ? '↑' : '↓'}"></span>
                                    <a th:href="@{'/getAllBooks'(sortField='ISBN', sortDir=${reverseSortDir})}">ISBN</a>
                                </th>
                                <th>
                                    <span th:if="${sortField == 'rating'}" th:text="${sortDir == 'asc' ? '↑' : '↓'}"></span>
                                    <a th:href="@{'/getAllBooks'(sortField='rating', sortDir=${reverseSortDir})}">Rating</a>
                                </th>
                                <th>
                                    <span th:if="${sortField == 'pubDate'}" th:text="${sortDir == 'asc' ? '↑' : '↓'}"></span>
                                    <a th:href="@{'/getAllBooks'(sortField='publicationDate', sortDir=${reverseSortDir})}">Publication Date</a>
                                </th>
                                <th>
                                    <span th:if="${sortField == 'reviewer'}" th:text="${sortDir == 'asc' ? '↑' : '↓'}"></span>
                                    <a th:href="@{'/getAllBooks'(sortField='reviewer', sortDir=${reverseSortDir})}">Reviewer</a>
                                </th>
                                <th>Reviews</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="book:${allBooks}">
                                <td th:text="${book.title}"></td>
                                <td th:text="${book.author}"></td>
                                <td th:text="${book.ISBN}"></td>
                                <td>
                                    <span th:each="i : ${#numbers.sequence(1,5)}">
                                        <span th:text="*{i <= book.rating ? '★' : '☆'}"></span>
                                    </span>
                                </td>
                                <td th:text="${book.publicationDate}"></td>
                                <td th:text="${book.reviewer}"></td>
                                <!-- d th:text="${book.review}"></td --->
                                <td>
                                    <span th:text="${#strings.abbreviate(book.review, 125)}"></span>
                                    <a href="#" class="ms-2 text-primary text-decoration-underline"
                                       data-bs-toggle="modal"
                                       data-bs-target="#reviewModal"
                                       th:attr="data-review=${book.review}"
                                       onclick="handleReviewClick(this)">
                                        Read more
                                    </a>
                                </td>
                                <td><a th:href="@{/edit/{id}(id=${book.id})}">Edit Book</a> </td>
                                <td>
                                    <form th:action="@{/delete/{id}(id=${book.id})}" method="post"
                                        th:onsubmit="return confirm('Delete this book?');" style="display:inline;">
                                        <input type="submit" value="Delete"/>
                                    </form>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <div class="modal fade" id="reviewModal" tabindex="-1" aria-labelledby="reviewModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-lg modal-dialog-scrollable">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="reviewModalLabel">Full Review</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p id="modalReviewContent"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function handleReviewClick(el) {
        const review = el.getAttribute("data-review");
        document.getElementById("modalReviewContent").textContent = review;
    }
</script>
</body>
</html>